\RequirePackage{amsmath,amssymb}

%\RequirePackage[T1]{fontenc}
\RequirePackage[brazil]{babel}
\RequirePackage{float}
\RequirePackage{makecell}
\RequirePackage{tasks}

\RequirePackage{geometry}
\geometry{
textwidth=157mm,
textheight=250mm,
paperwidth=196mm,
paperheight=280mm,
top=.3in,
left=27mm,
footskip=.35in
}

% Para usar alinhamento vertical em tabelas.
\RequirePackage{array}
% Para hiperreferências - é utilizado na segunda página
\usepackage{hyperref}
% Para utilizar tamanho de fonte qualquer.
\usepackage{anyfontsize}
% Para enumerates customizados
\RequirePackage{enumerate}
\RequirePackage[shortlabels]{enumitem} %allow resume enumerate, but conflicts with enumerate package

\setlist[enumerate,1]{label={\alph*)}}
\setlist[enumerate,2]{label={\Roman*)}}


\RequirePackage{graphicx}
\RequirePackage{adjustbox}
\graphicspath{{/home/simas/Documentos/livro_aberto/fracoes_livro_piloto/figuras/}}
\RequirePackage{hyperref}
\RequirePackage{multicol}

% Para usar tabelas balanceadas
\RequirePackage{tabulary}
\RequirePackage{tabu}
\RequirePackage{longtable}% para quebrar tabela entre páginas
% Place crop marks
\RequirePackage[center,height=297mm,width=210mm,cam]{crop}
%\RequirePackage{cabin}
% Choose font
\RequirePackage{ifxetex}
\ifxetex
   \RequirePackage{fontspec}
   \setmainfont{Lato-Light.ttf}[BoldFont=Lato-Medium.ttf, ItalicFont=Lato-LightItalic.ttf, BoldItalicFont=Lato-MediumItalic.ttf]
   \newfontface\titlefont{STIXIntUp.ttf}
   \newfontface\thickfont{NimbusSanL-Reg.otf}[BoldFont=NimbusSanL-Bol.otf, ItalicFont=NimbusSanL-RegIta.otf, BoldItalicFont=NimbusSanL-BolIta.otf]
   \newfontface\bigtitlefont[Scale=1.3]{Cabin-Regular.ttf}[BoldFont=Cabin-Bold.ttf, ItalicFont=Cabin-Italic.ttf, BoldItalicFont=Cabin-BoldItalic.ttf]
   %\setmonofont{Homemade Apple}
   %\newcommand\titlefont{}
   %\newcommand\thickfont{}
\else
%   \RequirePackage[utf8]{inputenc}
%   \RequirePackage[sfdefault,thin]{roboto}  %% sfdefault is the base font
   \RequirePackage{helvet}
   \newcommand\titlefont{\fontfamily{helvet}\selectfont}
   \newcommand\thickfont{\fontfamily{cmss}\selectfont}
   \newcommand\bigtitlefont{\fontfamily{cmss}\selectfont}
\fi

% Larger spacing between lines
\linespread{1.2}

% Temporary library for generating random text
\RequirePackage{lipsum}

% To define colors
\RequirePackage[dvipsnames]{xcolor}
% \definecolor{light}{RGB}{21,101,175}
% \definecolor{special}{RGB}{154,195,33}
% \definecolor{common}{RGB}{204,216,241}
% \definecolor{common}{RGB}{108,153,215}
% \definecolor{attention}{RGB}{210,32,39}
% \definecolor{special}{RGB}{179,220,47}
% 
% \definecolor{dark}{RGB}{78,57,93}
% \definecolor{common}{RGB}{130,112,133}
% \definecolor{special}{RGB}{142,190,148}
% \definecolor{light}{RGB}{204,252,142}
% \definecolor{attention}{RGB}{220,91,62}

\definecolor{dark}{RGB}     {97,83,117}
\definecolor{common}{RGB}   {142,178,197}
\definecolor{special}{RGB}  {229,98,92}
\definecolor{light}{RGB}    {249,191,118}
\definecolor{attention}{RGB}{209,49,61}

%% Colorblind palete
\definecolor{cbolive}{RGB}     {24,157,122}
\definecolor{cborange}{RGB}   {230,96,0}
\definecolor{cbpurple}{RGB}  {122,113,180}
\definecolor{cbpink}{RGB}    {246,39,150}
\definecolor{cbgreen}{RGB}  {107,165,31}
\definecolor{cbyellow}{RGB}  {246,175,7}
\definecolor{cbbrown}{RGB}    {172,116,31}
\definecolor{cbgray}{RGB}  {98,101,98}




% use o GIMP para obter o cógigo HTML da cor e o site a seguir para converter para RGB
% http://www.yellowpipe.com/yis/tools/hex-to-rgb/color-converter.php


% \RequirePackage{lastpage} % Required to determine the last page for the footer

% Pacotes para desenhos
\RequirePackage{tikz}
\usetikzlibrary{shapes}
\usetikzlibrary{calc}
\usetikzlibrary{quotes, arrows}
\usetikzlibrary{positioning}
\RequirePackage{mathrsfs}
\usetikzlibrary{decorations.pathreplacing}%to use braces in pictures
% This package provides special PGF/TikZ nodes for the text, marginpar, footer and header area of the current page.
\RequirePackage{tikzpagenodes}
\tikzset{x=1mm,y=1mm}

%%%%%%%%%%%%%%% Change margin size for second page %%%%%%%%%%%%%%%%%%%%%%
\newenvironment{changemargin}[2]{%
\begin{list}{}{%
\setlength{\topsep}{0pt}%
\setlength{\leftmargin}{#1}%
\setlength{\rightmargin}{#2}%
\setlength{\listparindent}{\parindent}%
\setlength{\itemindent}{\parindent}%
\setlength{\parsep}{\parskip}%
}%
\item[]}{\end{list}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%% Chapter and section titles %%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage[explicit]{titlesec} % needed for define chapter and section style.
\setcounter{chapter}{0}
%\setcounter{subsection}{1}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{titling}

% %Chapter
% \titleformat{\chapter} % redefining chapter appearence
% %{} % style
% {\titlefont\Huge\bf} % style
% {} % label
% {0pt} % separation
% {\begin{tikzpicture}[remember picture,overlay]
%     \filldraw [x=1mm,y=1mm, special, overlay] (37,0) circle [radius=9];
%     \filldraw [x=1mm,y=1mm, attention, overlay] (58,0) circle [radius=9];
%     \filldraw [x=1mm,y=1mm, light, overlay] (79,0) circle [radius=9];
%     \filldraw [x=1mm,y=1mm, common, overlay] (210,-9) -- (100 ,-9) arc (-90:-270:9) --(100,9)
%     -- (210,9); (118, 0) node{\color{white} Lição \thechapter} (105,-27);
%   \end{tikzpicture}
% } % before title
% [\vspace{3cm} \hfill{\bf\bigtitlefont\raggedright\color{special} #1}] % after title
% %\titlespacing*{\chapter}{0pt}{50pt}{100pt} % {<command>}{<left>}{<before-sep>}{<after-sep>}

% Section style ---- EXPLORANDO O ASSUNDO, ORGANIZANDO AS IDEIAS, MÃO NA MASSA, etc.
%\newcommand*\sectionlabel{}
\titleformat{\section}
  {\titlefont\bf}
  {\gdef\sectionlabel{\thesection\ }}{0pt}
  {%
    \begin{tikzpicture}[remember picture,overlay]
      \filldraw [x=1mm,y=1mm, attention, overlay] (1.2\textwidth,-4) -- (0 ,-4)
      arc (-90:-270:4) --(0,4) -- (1.2\textwidth,4)
      node[anchor=west] at (0, 0) {\color{white} \MakeUppercase{#1}};
   \end{tikzpicture}
 }
\titlespacing*{\section}{0pt}{20pt}{20pt} % {<command>}{<left>}{<before-sep>}{<after-sep>}

% Subsection style
\renewcommand{\thesubsection}{\arabic{subsection}}% to define subsection numbering without section number
\titleformat{\subsection}[block]{\normalfont\normalsize\bfseries\color{special}}
{Atividade \thesubsection}{20pt}{\Huge}
% 
% \titleformat*{\subsection} % redefining subsection appearence - Atividade
% {\normalsize}
% {}
% {0pt}
% \titlespacing*{\subsection}{0pt}{20pt}{20pt} % {<command>}{<left>}{<before-sep>}{<after-sep>}

%%%%%%%%%%%%%%%%%%%%%%% Custom headers and footers %%%%%%%%%%%%%%%%%%%%%%%
\RequirePackage{extramarks} % Required for headers and footers
\RequirePackage{fancyhdr}
\pagestyle{fancy}

% Chapter mark
\renewcommand{\chaptermark}[1]{\markboth{\ #1}{}}
% documentation abaout chaptermark, markboth, etc. https://www.ntg.nl/maps/16/29.pdf

% Section mark
\renewcommand{\sectionmark}[1]{\markright{\ #1}} % Sections not in uppercase, not numbered

\RequirePackage{chngcntr}
\counterwithout{subsection}{section}

% Footers
\fancyfoot[C]{%
\noindent%
\tikz[baseline]{\draw[color=ref, line width=0.6pt] (-0.5, 0) -- (6, 0);}%
}

% Left footer
\fancyfoot[LE]{
  {\tikz{\draw[color=attention, line width=0.6pt] (-1.8, 0) -- (\textwidth, 0);}}\newline
  {\tikz[x=1mm,y=1mm]{\filldraw [attention, overlay] (-20,-3) -- (-5 ,-3)
      arc (-90:90:3) --(-5,3) -- (-20,3) (-8, 0) node{\color{white} {\bf \thepage}};}}
  {\small\color{dark}LIÇ\~AO \thechapter \; - \;  \leftmark}
}


% Right footer
\fancyfoot[RO]{
  {\tikz{\draw[color=attention, line width=0.6pt] (-1.8, 0) -- (\textwidth, 0);}}\newline
  {\small\color{dark} \rightmark}
  {\tikz[x=1mm,y=1mm]{\filldraw [attention, overlay] (20,-3) -- (5 ,-3)
      arc (-90:-270:3) --(5,3) -- (20,3) (8, 0) node{\color{white} {\bf \thepage}};}}
}%


\fancyfoot[C]{}

% Header
% Clear all header fields
\fancyhead{}
% No header rule
\renewcommand{\headrulewidth}{0pt}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%% Cabeçalho %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand\Header{%
\begin{tikzpicture}[remember picture,overlay]
%\fill[common]
%  ([yshift=1mm]current page.north west) -- (current page.north east) --
%  ([yshift=0.3cm]current page.north east|-current page text area.north east) --
%  ([yshift=0.3cm]current page.north west|-current page text area.north west) -- cycle;
\fill[fill=common]
  ([yshift=2mm,xshift=-2mm]current page.north west) rectangle ([yshift=-5mm,xshift=2mm]current page.north east);
%\node[font=\sffamily\bfseries\color{white},anchor=east, % Texto dentro do cabeçalho acima
  xshift=-1.5cm,yshift=-1.3cm] at (current page.north east)
 % {\fontsize{50}{60}\selectfont  };
\end{tikzpicture}%
}
% This package provides various commands to be executed before a \shipout
\RequirePackage{atbegshi}
\AtBeginShipout{\Header}
\AtBeginShipoutFirst{\Header}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%% Ambientes %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Permite quebrar o tikz dentro da definição de um novo ambiente- como refletindo:
% http://tex.stackexchange.com/questions/5639 para explicação detalhada.
\RequirePackage{environ}

% Atividade
% \newcounter{atividade}
% \newenvironment{atividade}[1][]{\refstepcounter{atividade}\par\medskip
%    \noindent \textbf{\textcolor{light}{Atividade~\theatividade #1 \rmfamily \rmfamily}}}{\medskip}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Refletindo
\RequirePackage[many]{tcolorbox}
%\RequirePackage{varwidth}
\tcbuselibrary{listings,breakable,most}
\newtcolorbox{refletindo*}[2][]{%
colframe=common,
colbacktitle=white,
coltitle=special,
boxed title style={arc=3mm,boxrule=.7mm,height=8mm,valign=center},
enhanced,colback=white,
boxrule=.7mm,titlerule=3mm,
attach boxed title to top left={yshift=-2mm,xshift=3mm},
arc=4mm,
breakable,
fontupper=\thickfont,
title={\bf REFLETINDO},#1}

% Caixinha extra
\newtcolorbox{caixinha}[2][]{%
width=.95\textwidth,
colframe=common,
enhanced,
colback=white,
boxrule=.7mm,
arc=4mm,
breakable,
fontupper=\thickfont,
}

%Atividade

\newtcolorbox[auto counter, number within=chapter, number freestyle={\noexpand\arabic{\tcbcounter}}]{atividade}[2][]{%
colframe=white,
colbacktitle=white,
coltitle=special,
enhanced,colback=white,
left=0pt, right=0pt, bottom=0mm, top=0mm,
% boxrule=.7mm,titlerule=3mm,
% attach boxed title to top left={yshift=-2mm,xshift=3mm},
% arc=4mm,
breakable,
title={\bf Atividade~\thetcbcounter},#1}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newtcbtheorem{professor}{Para o Professor}%
{colback=purple!15,colframe=purple,fonttitle=\bfseries}{th}
\newtcbtheorem{introdutorio}{Introdutório}%
{colback=green!5,colframe=green!35!black,fonttitle=\bfseries}{th}
\newtcbtheorem{abstrato}{Modelo abstrato}%
{colback=green!5,colframe=green!35!black,fonttitle=\bfseries}{th}
\newtcbtheorem{conexoes}{Conexões}%
{colback=green!5,colframe=green!35!black,fonttitle=\bfseries}{th}
\newtcbtheorem{explorando}{Explorando}%
{colback=green!5,colframe=green!35!black,fonttitle=\bfseries}{th}
\newtcbtheorem{massa}{Mão na massa}%
{colback=green!5,colframe=green!35!black,fonttitle=\bfseries}{th}
\newtcbtheorem{exercicio}{Exercício}%
{colback=gray!15,colframe=gray,fonttitle=\bfseries}{th}
\newtcbtheorem{resposta}{Resposta}%
{colback=blue!5,colframe=blue,fonttitle=\bfseries}{th}
\newtcbtheorem{imagem}{Imagem}%
{colback=light!15,colframe=light,fonttitle=\bfseries}{th}
\newtcbtheorem{figura}{Figura}%
{colback=green!5,colframe=green!35!black,fonttitle=\bfseries}{th}
\newtcbtheorem{nota}{Nota}%
{colback=gray!5,colframe=gray!35!black,fonttitle=\bfseries}{th}

%tikz definitions
\def \tripinha{ (30:4) -- (90:4) -- (150:4)--(210:4)--(270:4)--(330:4) [shift={({4*sqrt(3)},0)}] --(270:4) -- (330:4) -- (30:4) -- (90:4)--(150:4)--cycle;}

\def \tripa{ (30:4) -- (90:4) -- (150:4)--(210:4)--(270:4)--(330:4) [shift={({4*sqrt(3)},0)}] --(270:4) -- (330:4) [shift={({4*sqrt(3)},0)}]--  (270:4) -- (330:4) -- (30:4) -- (90:4)--(150:4) [shift={({-4*sqrt(3)},0)}] -- (90:4) -- (150:4)--cycle;}

\def \tripalonga{ (30:4) -- (90:4) -- (150:4)--(210:4)--(270:4)--(330:4) [shift={({4*sqrt(3)},0)}] --(270:4) -- (330:4) [shift={({4*sqrt(3)},0)}] --(270:4) -- (330:4)[shift={({4*sqrt(3)},0)}] --(270:4) -- (330:4) [shift={({4*sqrt(3)},0)}]--  (270:4) -- (330:4) -- (30:4) -- (90:4)--(150:4) [shift={({-4*sqrt(3)},0)}] -- (90:4) -- (150:4)[shift={({-4*sqrt(3)},0)}] -- (90:4) -- (150:4) [shift={({-4*sqrt(3)},0)}] -- (90:4) -- (150:4)--cycle;}

\def\hsp{150} 

\def\EixoM{0.5}
